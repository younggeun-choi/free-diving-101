# Internationalization (i18n)

이 문서는 Free Diving 101 프로젝트의 다국어 지원 가이드입니다.

---

## 개요

이 프로젝트는 `i18next` + `react-i18next` + `expo-localization`을 사용하여 다국어를 지원합니다.

### 지원 언어

- **영어 (en)**: 기본 fallback 언어
- **한국어 (ko)**: 지원 언어

### 패키지

- `expo-localization`: ~17.0.7 - 기기 언어 감지
- `i18next`: ^25.6.0 - i18n 프레임워크
- `react-i18next`: ^16.0.1 - React 통합
- `@react-native-async-storage/async-storage`: 2.2.0 - 사용자 언어 선택 저장

---

## 파일 구조

```
src/shared/
├── locales/
│   ├── en.json          # 영어 번역
│   ├── ko.json          # 한국어 번역
│   └── index.ts         # 번역 리소스 export
└── lib/i18n/
    ├── config.ts        # i18n 초기화 및 설정
    └── index.ts         # i18n export
```

---

## 사용법

### 컴포넌트에서 번역 사용

```tsx
import { useTranslation } from 'react-i18next';

export function WelcomeScreen() {
  const { t } = useTranslation();

  return (
    <View>
      <Text>{t('home.title')}</Text>
      <Text>{t('home.subtitle')}</Text>
    </View>
  );
}
```

### 매개변수가 있는 번역

```tsx
const { t } = useTranslation();

// 단수형
<Text>{t('equalizing.day', { number: 1 })}</Text>
// 출력: "Day 1" (en) / "1일차" (ko)

// 복수형 (i18next 자동 처리)
<Text>{t('home.streakDays', { count: 5 })}</Text>
// 출력: "5 days streak" (en) / "5일 연속" (ko)
```

### 언어 변경

```tsx
import { changeLanguage } from '@/shared/lib/i18n';

// 언어 변경 함수
const handleLanguageChange = async (lang: 'en' | 'ko') => {
  try {
    await changeLanguage(lang);
  } catch (error) {
    console.error('Failed to change language:', error);
  }
};
```

### 현재 언어 확인

```tsx
import { getCurrentLanguage } from '@/shared/lib/i18n';

const currentLang = getCurrentLanguage();
console.log(currentLang); // 'en' 또는 'ko'
```

---

## 새 번역 추가

### 1. 번역 파일 업데이트

`src/shared/locales/en.json`과 `ko.json`에 번역 키 추가:

```json
// src/shared/locales/en.json
{
  "newFeature": {
    "title": "New Feature",
    "description": "This is a new feature"
  }
}

// src/shared/locales/ko.json
{
  "newFeature": {
    "title": "새 기능",
    "description": "이것은 새로운 기능입니다"
  }
}
```

### 2. 컴포넌트에서 사용

```tsx
const { t } = useTranslation();
<Text>{t('newFeature.title')}</Text>
```

---

## 새 언어 추가

### 1. 번역 파일 생성

`src/shared/locales/ja.json` (예: 일본어) 생성

```json
{
  "home": {
    "title": "フリーダイビング 101",
    "subtitle": "初心者向けトレーニング"
  }
}
```

### 2. locales/index.ts 업데이트

```typescript
import en from './en.json';
import ko from './ko.json';
import ja from './ja.json'; // 추가

export const resources = {
  en: { translation: en },
  ko: { translation: ko },
  ja: { translation: ja }, // 추가
} as const;

export type SupportedLanguage = keyof typeof resources;
export const supportedLanguages: SupportedLanguage[] = ['en', 'ko', 'ja']; // 추가
```

### 3. i18n 설정 확인

`src/shared/lib/i18n/config.ts`에서 새 언어가 자동으로 지원됩니다:

```typescript
i18n.use(initReactI18next).init({
  compatibilityJSON: 'v4',
  resources,
  lng: deviceLanguage,
  fallbackLng: 'en',
  // ...
});
```

---

## TTS (Text-to-Speech) 지원

### 기본 사용법

```tsx
import { useTTSManager } from '@/shared/lib/tts';

export function MyComponent() {
  const { speak, stop } = useTTSManager();

  const handleSpeak = () => {
    speak('home.title'); // 번역 키로 직접 TTS 실행
  };

  return (
    <Button onPress={handleSpeak}>
      <Text>읽기</Text>
    </Button>
  );
}
```

### 매개변수가 있는 TTS

```tsx
const { speak } = useTTSManager();

// 매개변수가 있는 번역 키
speak('equalizing.day', { number: 3 });
// "Day 3" (영어) 또는 "3일차" (한국어)로 읽음
```

### 언어별 TTS

- `useTTSManager` 훅은 현재 언어를 자동으로 감지합니다
- 언어 변경 시 TTS도 자동으로 해당 언어로 전환됩니다
- 지원 언어:
  - 영어 (en-US)
  - 한국어 (ko-KR)

---

## 주의사항

### i18next v25.6.0 호환성

- `compatibilityJSON: 'v4'`를 사용합니다
- React Native AsyncStorage와 호환됩니다

### 번역 키 네이밍

- **일관성 있게** 네이밍하세요 (예: `section.subsection.key`)
- 예시:
  - `home.title`
  - `equalizing.day`
  - `co2Table.settings.breathHold`

### 번역 키 구조

- **모든 지원 언어**에 동일한 키 구조를 유지하세요
- 한 언어에만 있는 키는 fallback 언어(영어)로 표시됩니다

### 데이터 영속성

- 사용자가 선택한 언어는 **AsyncStorage에 자동 저장**됩니다
- 앱 재시작 시 마지막 선택 언어가 로드됩니다
- 기기 언어가 지원되지 않으면 **영어(en)**로 fallback됩니다

---

## 트러블슈팅

### 번역이 표시되지 않음

1. 번역 키가 모든 언어 파일에 있는지 확인
2. i18n이 초기화되었는지 확인 (`src/shared/lib/i18n/config.ts`)
3. `useTranslation()` 훅이 컴포넌트에서 올바르게 사용되었는지 확인

### TTS가 작동하지 않음

1. `expo-speech` 패키지가 설치되었는지 확인
2. 기기에서 TTS 권한이 허용되었는지 확인
3. 해당 언어의 TTS 음성이 기기에 설치되어 있는지 확인

---

## 관련 문서

- [i18next 공식 문서](https://www.i18next.com/)
- [react-i18next 공식 문서](https://react.i18next.com/)
- [Expo Localization](https://docs.expo.dev/versions/latest/sdk/localization/)
- [Expo Speech](https://docs.expo.dev/versions/latest/sdk/speech/)
